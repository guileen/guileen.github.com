---
title: 推荐系统架构
date: 2021-04-09 22:13:09
tags:
---


## 0x00 架构目标

推荐系统的目标简而言之是从全量Item（商品、内容、人）中为用户找到一个最符合业务价值的一部分有序子集。这个最有价值，通常要综合考虑用户的兴趣以及平台的商业模式。比如对于视频网站而言，用户的观看时长是最能代表这个价值的，而影评网站则要推荐用户评分最高的那些影片。

我们关心的问题是推荐效果和算法复杂度。

## 0x01 架构设计

按数据来划分可分为：大数据平台 => 召回层 => 排序层 => 融合层。总数据量，亿级，召回层千级、万级，排序层百级，融合层十级。

按计算来划分可分为：离线层=> 近线层 => 在线层

![](/img/recsys/netflix.jpeg)

https://www.cnblogs.com/shengyang17/p/11546299.html

## 0x02 召回层算法

召回算法通常采用多种模型，尽可能多的召回物品。主要采用简单高效的算法，也包含一些简单的策略如热门物品、新发布物品等。协同过滤模型不适用用户和物品的特征数据，只使用用户行为数据。

### 矩阵分解

经典的协同过滤算法，泛化能力不足，已不再流行。现在更多的是采用矩阵分解方法，将评分矩阵分解为用户矩阵和物品矩阵的叉乘，相当于有一个K维的隐含特征，用户与物品在这个K维特征上相契合，则会有很高的推荐度。优化目标是最小化评分矩阵与预测矩阵的距离。

![](/img/recsys/mf.png)

[ALS算法](https://antkillerfarm.github.io/ml/2016/12/29/Machine_Learning_16.html) 一个离线的可以并行的算法，但缺点是无法增量更新。[Fast incremental matrix factorization forrecommendation with positive-only feedback](https://asset-pdf.scinapse.io/prod/30495595/30495595.pdf) 这篇论文介绍了一种使用 ISGD 算法进行矩阵分解的增量更新算法。

![](/img/recsys/ISGD.png)

这个算法仅考虑了正样本，其中的 $ err_(ui)=1-A_uB_i^T $ 可以改进为 $ err_(ui)=R_(ui)-A_uB_i^T $。采用这个算法可以使我们的模型增量更新。

## 0x03 排序层算法

在矩阵分解中，我们没有使用用户和物品的特征，这无疑是对信息的浪费。在排序层中，我们将问题转化为一个2分类问题，即 P(y=1|X)，用户喜欢一个物品的概率。其中X为 {用户特征、物品特征、场景特征}。这里有大量的机器学习方法可以使用，常用的有 LR（线性回归），FM/FFM（隐向量特征交叉），GBDT+LR（其中GBDT完成了特征工程部分，LR完成了回归部分）。

深度学习在这一层也有越来越多的应用，Embedding技术主要使用在特征工程的阶段。