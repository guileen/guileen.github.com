---
title: 曝光过滤中的增量布隆过滤器
tags:
---

在推荐系统的推荐结果中，需要对用户已经浏览过的内容进行去重，这叫做曝光过滤。为了实现这一功能，最简单的做法是将用户的所有浏览历史保存为一个列表，逐一比对。这样做的时间复杂度和空间复杂度都很高。布隆过滤器相比列表拥有更高的空间利用率，更快的比对速度，但是有可能有一定的概率将未浏览过的内容判别为已浏览的内容了。对于推荐系统而言这种错误是可以容忍的。

但是布隆过滤器方案也个一些缺点：对于低频用户，需要单独开辟一块内存，但用户可能只看了一两条内容，内存利用率低。而对于高频用户，则错误率可能增加。对于这个问题，我们可以自然的想到，将低频用户和高频用户集中放在一大块内存中，而不是单独为每个用户分配内存。这样既降低高频用户的错误率，又增加了内存的使用效率，避免为每个用户开辟内存的空间浪费。

但是仅使用一大块内存也有一个缺点：系统很难随着用户量的增长进行横向扩展，调整内存大小将会使之前的hash结果失效，也会存在访问竞争的性能问题。我们可以自然的想到将用户进行hash分组。分组数量必须是固定的，这依然限制了系统的横向扩展性。

本文将介绍一种方法，解决横向扩展问题。首先我们要求，user_id必须是递增的，我们将用户按id值划分为不同年级。尽可能使每个年级拥有差不多的用户数。

添加一个代际的概念